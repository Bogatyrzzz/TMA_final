# LifeQuest Hero — PRD (Актуальная версия)

## Обзор
LifeQuest Hero — Telegram Mini App для геймификации реальной жизни. Пользователь выполняет квесты, получает XP, растит уровень и закрывает личные цели‑награды. Визуальным центром является AI‑персонаж, генерируемый через n8n и отображаемый как фон главного экрана (формат 9:16).

## Цели продукта
- Создать ощущение “игры” в реальной жизни через квесты, уровни и награды
- Повысить вовлечённость через визуальную идентичность (герой на фоне)
- Дать пользователю ясную мотивацию через цели‑подарки

## Целевая аудитория
- Пользователи Telegram, которые хотят дисциплины и мотивации
- Любители RPG‑механик, достижений и визуального прогресса

## Основной пользовательский путь
1. Вход через Telegram Mini App
2. Онбординг: возраст, пол, ветка развития, цель‑подарок, селфи‑ссылка
3. Запуск генерации героя через n8n
4. Экран генерации с прогресс‑баром до появления изображения
5. Домашний экран с героем на фоне
6. Выполнение квестов → XP → уровни → обновление аватара каждые 5 уровней
7. Достижение цели‑подарка → уведомление и отметка выполненности

## Текущее состояние (реализовано)
- Онбординг: возраст, пол, ветка, цель, уровень цели, селфи‑ссылка
- Главный экран: HUD, XP‑бар, статы, фоновый аватар
- Квесты: список, подтверждение, начисление XP
- Цели‑подарки: создание, редактирование, архив, выполненные
- Нотификации цели: Telegram bot sendMessage при достижении уровня
- Генерация героя: триггер из backend → n8n → webhook возвращает avatar_url
- Экран генерации: “Генерируем твоего героя” с прогресс‑баром

## UX/Visual требования
- Dark, RPG‑style UI, “juicy/tactile” ощущения
- Glassmorphism + 3D кнопки
- Анимации появления, shimmer‑эффекты, микровзаимодействия
- Аватар героя как фоновый иммерсивный слой

## Архитектура
- Frontend: React + TailwindCSS + Framer Motion + lucide‑react
- Backend: FastAPI
- DB/Storage: Supabase (PostgreSQL + Storage)
- Интеграции: Telegram Mini App SDK, Telegram Bot API, n8n webhook

## Ключевые сервисы
- Backend:
  - /api/users/register
  - /api/users/{tg_id}/onboarding
  - /api/users/{tg_id}
  - /api/users/{tg_id}/progress
  - /api/users/{tg_id}/goals
  - /api/users/{tg_id}/quests
  - /api/webhooks/avatar-generated
- n8n:
  - Входящий webhook “lifequest-avatar”
  - Генерация изображения 9:16
  - Загрузка в Supabase Storage
  - Callback в backend с avatar_url

## Данные (основные сущности)
- users: tg_id, username, age, gender, avatar_url, selfie_url, stats
- progress: уровень, XP
- goals: тексты целей, целевой уровень, статус выполнения
- quests + user_quests

## Метрики успеха
- Конверсия регистрации → завершение онбординга
- Доля пользователей с сгенерированным аватаром
- Ежедневно активные пользователи (DAU)
- Среднее количество квестов в день
- Доля выполненных целей

## Планируемые улучшения
### Ближайшие шаги
- Загрузка селфи как файла в онбординге
- Поле “текстовое описание” пользователя для генерации героя
- Валидации: проверка корректности селфи и подсказки
- Улучшение статуса генерации: этапы и % прогресса

### Оптимизация
- Кэширование изображений (aggressive caching)
- Предзагрузка и плавный fade‑in героя
- Контроль веса фонового изображения
- Повторные попытки webhook при ошибке
- Наблюдаемость: логирование n8n статуса генерации

### Функционал
- Экран “Мудрец” (Sage)
- Достижения и коллекции
- PRO через Telegram Stars
- Социальные функции (рейтинги, друзья)

## Требования к онбордингу (обновление)
Обязательно добавить:
- Загрузка селфи (файл)
- Поле “Краткое описание” (например: стиль, настроение, роль)
Цель: максимально похожий на пользователя персонаж

## Требования к инфраструктуре
Backend .env:
- SUPABASE_URL
- SUPABASE_KEY
- N8N_WEBHOOK_URL
- TELEGRAM_BOT_TOKEN
Frontend .env:
- REACT_APP_BACKEND_URL
- REACT_APP_SUPABASE_URL
- REACT_APP_SUPABASE_KEY

